import{j as e}from"./ui-vendor-BtEcf0g7.js";import{r as j}from"./react-vendor-DUZ_c4H6.js";import{a8 as K,a9 as R,k as F,z as V,aa as $,ab as z,r as H,u as q,a as E,b as I,ac as L,E as w,ad as U,i as y,H as v,J as C,K as b,j as N,I as h,V as O,B as A,ae as Q,af as J,ag as x}from"./main-DVW5hlyI.js";import{t as T}from"./api-DDrtQDax.js";const G=K,B=j.createContext(null),u=({...a})=>e.jsx(B.Provider,{value:{name:a.name},children:e.jsx(R,{...a})}),S=()=>{const a=j.useContext(B),i=j.useContext(D),{getFieldState:n,formState:t}=z();if(!a)throw new Error("useFormField should be used within <FormField>");if(!i)throw new Error("useFormField should be used within <FormItem>");const c=n(a.name,t),{id:r}=i;return{id:r,name:a.name,formItemId:`${r}-form-item`,formDescriptionId:`${r}-form-item-description`,formMessageId:`${r}-form-item-message`,...c}},D=j.createContext(null),d=j.forwardRef(({className:a,...i},n)=>{const t=j.useId();return e.jsx(D.Provider,{value:{id:t},children:e.jsx("div",{ref:n,className:F("space-y-2",a),...i})})});d.displayName="FormItem";const l=j.forwardRef(({className:a,...i},n)=>{const{error:t,formItemId:c}=S();return e.jsx(V,{ref:n,className:F(t&&"text-destructive",a),htmlFor:c,...i})});l.displayName="FormLabel";const m=j.forwardRef(({...a},i)=>{const{error:n,formItemId:t,formDescriptionId:c,formMessageId:r}=S();return e.jsx($,{ref:i,id:t,"aria-describedby":n?`${c} ${r}`:`${c}`,"aria-invalid":!!n,...a})});m.displayName="FormControl";const f=j.forwardRef(({className:a,...i},n)=>{const{formDescriptionId:t}=S();return e.jsx("p",{ref:n,id:t,className:F("text-[0.8rem] text-muted-foreground",a),...i})});f.displayName="FormDescription";const p=j.forwardRef(({className:a,children:i,...n},t)=>{const{error:c,formMessageId:r}=S(),_=c?String(c?.message??""):i;return _?e.jsx("p",{ref:t,id:r,className:F("text-[0.8rem] font-medium text-destructive",a),...n,children:_}):null});p.displayName="FormMessage";const W=J({nome_empresa:x().min(2,"Nome muito curto"),email_contato:x().email(),horario_inicio:x(),horario_fim:x(),cor_primaria:x(),cor_secundaria:x(),hms_app_access_key:x().optional(),hms_app_secret:x().optional(),hms_management_token:x().optional(),hms_template_id:x().optional(),hms_api_base_url:x().optional()});function se(){const{toast:a}=H(),i=q(),{data:n,isLoading:t}=E({queryKey:["/api/tenants/me"],queryFn:async()=>(await T.me()).data}),c=I({mutationFn:async s=>(await T.update(s)).data,onSuccess:()=>{i.invalidateQueries({queryKey:["/api/tenants/me"]}),a({title:"Configura√ß√µes salvas",description:"As configura√ß√µes do tenant foram atualizadas com sucesso."})},onError:s=>{a({title:"Erro ao salvar",description:s.response?.data?.message||"N√£o foi poss√≠vel salvar as configura√ß√µes.",variant:"destructive"})}}),r=L({resolver:Q(W),defaultValues:{nome_empresa:"",email_contato:"",horario_inicio:"09:00",horario_fim:"18:00",cor_primaria:"#3B82F6",cor_secundaria:"#10B981",hms_app_access_key:"",hms_app_secret:"",hms_management_token:"",hms_template_id:"",hms_api_base_url:"https://api.100ms.live/v2"}}),{data:_}=E({queryKey:["/api/config/hms100ms/credentials"],queryFn:async()=>{try{const s=await fetch("/api/config/hms100ms/sync-from-env",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const g=await s.json();if(console.log("‚úÖ [HMS] Credenciais sincronizadas",{syncedFromEnv:g.syncedFromEnv}),g.credentials)return g}const o=await fetch("/api/config/hms100ms/credentials",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});return o.ok?o.json():null}catch(s){return console.error("‚ùå [HMS] Erro ao carregar credenciais:",s),null}}});j.useEffect(()=>{if(n){const s=n.configuracoes||{},o={nome_empresa:n.nome||"",email_contato:n.email||"",horario_inicio:s.horario_comercial?.inicio||"09:00",horario_fim:s.horario_comercial?.fim||"18:00",cor_primaria:s.cores?.primaria||"#3B82F6",cor_secundaria:s.cores?.secundaria||"#10B981",hms_app_access_key:_?.credentials?.appAccessKey||"",hms_app_secret:_?.credentials?.appSecret||"",hms_management_token:_?.credentials?.managementToken||"",hms_template_id:_?.credentials?.templateId||"",hms_api_base_url:_?.credentials?.apiBaseUrl||"https://api.100ms.live/v2"};console.log("üìã [Configuracoes] Resetando formul√°rio HMS com dados:",{appAccessKey:o.hms_app_access_key?"‚úÖ":"‚ùå",appSecret:o.hms_app_secret?"‚úÖ":"‚ùå",managementToken:o.hms_management_token?"‚úÖ":"‚ùå",templateId:o.hms_template_id?"‚úÖ":"‚ùå",apiBaseUrl:o.hms_api_base_url}),r.reset(o)}},[n,_,r]);const M=I({mutationFn:async s=>{const o=await fetch("/api/config/hms100ms",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(s)});if(!o.ok)throw new Error("Erro ao salvar configura√ß√£o");return o.json()},onSuccess:()=>{i.invalidateQueries({queryKey:["/api/config/hms100ms/credentials"]}),a({title:"100ms configurado",description:"Credenciais salvas com sucesso"})},onError:s=>{a({title:"Erro",description:s.message,variant:"destructive"})}}),k=I({mutationFn:async s=>{const o=await fetch("/api/config/hms100ms/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!o.ok){const g=await o.json();throw new Error(g.error||"Credenciais inv√°lidas")}return o.json()},onSuccess:()=>{a({title:"Sucesso!",description:"Credenciais do 100ms validadas com sucesso"})},onError:s=>{a({title:"Erro na valida√ß√£o",description:s.message,variant:"destructive"})}});function P(s){c.mutate({nome:s.nome_empresa,email:s.email_contato,configuracoes:{horario_comercial:{inicio:s.horario_inicio,fim:s.horario_fim},duracao_padrao:60,cores:{primaria:s.cor_primaria,secundaria:s.cor_secundaria}}}),s.hms_app_access_key&&s.hms_app_secret&&M.mutate({appAccessKey:s.hms_app_access_key,appSecret:s.hms_app_secret,managementToken:s.hms_management_token,templateId:s.hms_template_id,apiBaseUrl:s.hms_api_base_url})}return t?e.jsx("div",{className:"flex items-center justify-center h-[50vh]",children:e.jsx(w,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Configura√ß√µes"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie as configura√ß√µes da sua empresa e integra√ß√µes."})]}),e.jsx(U,{}),e.jsx(G,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(P),className:"space-y-8",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(y,{children:[e.jsxs(v,{children:[e.jsx(C,{children:"Dados da Empresa"}),e.jsx(b,{children:"Informa√ß√µes vis√≠veis para seus clientes."})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsx(u,{control:r.control,name:"nome_empresa",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Nome da Empresa"}),e.jsx(m,{children:e.jsx(h,{...s})}),e.jsx(p,{})]})}),e.jsx(u,{control:r.control,name:"email_contato",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Email de Contato"}),e.jsx(m,{children:e.jsx(h,{...s})}),e.jsx(p,{})]})})]})]}),e.jsxs(y,{children:[e.jsxs(v,{children:[e.jsx(C,{children:"Hor√°rio Comercial"}),e.jsx(b,{children:"Defina os hor√°rios dispon√≠veis para agendamento."})]}),e.jsx(N,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{control:r.control,name:"horario_inicio",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Abertura"}),e.jsx(m,{children:e.jsx(h,{type:"time",...s})}),e.jsx(p,{})]})}),e.jsx(u,{control:r.control,name:"horario_fim",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Fechamento"}),e.jsx(m,{children:e.jsx(h,{type:"time",...s})}),e.jsx(p,{})]})})]})})]}),e.jsxs(y,{children:[e.jsxs(v,{children:[e.jsx(C,{children:"Personaliza√ß√£o"}),e.jsx(b,{children:"Cores e identidade visual da sua marca."})]}),e.jsx(N,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(u,{control:r.control,name:"cor_primaria",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Cor Prim√°ria"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded border",style:{backgroundColor:s.value}}),e.jsx(m,{children:e.jsx(h,{...s})})]}),e.jsx(p,{})]})}),e.jsx(u,{control:r.control,name:"cor_secundaria",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Cor Secund√°ria"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded border",style:{backgroundColor:s.value}}),e.jsx(m,{children:e.jsx(h,{...s})})]}),e.jsx(p,{})]})})]})})]}),e.jsxs(y,{className:"md:col-span-2",children:[e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx(C,{children:"Integra√ß√£o com Reuni√£o (100ms)"}),e.jsx(b,{children:"Configure as credenciais para ativar videoconfer√™ncia em tempo real"})]})]})}),e.jsxs(N,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(u,{control:r.control,name:"hms_app_access_key",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"App Access Key *"}),e.jsx(m,{children:e.jsx(h,{...s,placeholder:"646..."})}),e.jsx(f,{children:"Chave de acesso do 100ms"}),e.jsx(p,{})]})}),e.jsx(u,{control:r.control,name:"hms_app_secret",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"App Secret *"}),e.jsx(m,{children:e.jsx(h,{type:"password",...s})}),e.jsx(f,{children:"Chave secreta do 100ms"}),e.jsx(p,{})]})}),e.jsx(u,{control:r.control,name:"hms_management_token",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Management Token"}),e.jsx(m,{children:e.jsx(h,{type:"password",...s})}),e.jsx(f,{children:"Token para gerenciar salas (opcional)"}),e.jsx(p,{})]})}),e.jsx(u,{control:r.control,name:"hms_template_id",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"Template ID"}),e.jsx(m,{children:e.jsx(h,{...s,placeholder:"645..."})}),e.jsx(f,{children:"ID do template de sala"}),e.jsx(p,{})]})})]}),e.jsx(u,{control:r.control,name:"hms_api_base_url",render:({field:s})=>e.jsxs(d,{children:[e.jsx(l,{children:"API Base URL"}),e.jsx(m,{children:e.jsx(h,{...s})}),e.jsx(f,{children:"URL base da API do 100ms (padr√£o: https://api.100ms.live/v2)"}),e.jsx(p,{})]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-blue-900",children:["‚ÑπÔ∏è ",e.jsx("strong",{children:"Como obter as credenciais:"})]}),e.jsxs("ul",{className:"text-sm text-blue-800 mt-2 space-y-1 ml-4 list-disc",children:[e.jsxs("li",{children:["Visite ",e.jsx("a",{href:"https://dashboard.100ms.live",target:"_blank",rel:"noopener noreferrer",className:"underline font-semibold",children:"dashboard.100ms.live"})]}),e.jsx("li",{children:"V√° para Configura√ß√µes ‚Üí Credenciais"}),e.jsx("li",{children:"Copie App Access Key e App Secret"}),e.jsx("li",{children:"Configure um Template de Sala para obter o Template ID"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(A,{type:"button",variant:"outline",disabled:k.isPending||!r.getValues("hms_app_access_key")||!r.getValues("hms_app_secret"),onClick:()=>k.mutate({appAccessKey:r.getValues("hms_app_access_key"),appSecret:r.getValues("hms_app_secret")}),children:k.isPending?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Testando..."]}):"Testar Credenciais"})})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(A,{type:"submit",size:"lg",disabled:c.isPending,children:c.isPending?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvando..."]}):"Salvar Altera√ß√µes"})})]})})]})}export{se as default};
