import{j as e}from"./ui-vendor-63y42yoU.js";import{r as T}from"./react-vendor-Go9vAp00.js";import{u as B,aQ as D,m as S,n as C,av as K,aR as N,aS as M,C as u,a as _,b as g,d as f,e as y,I as n,aM as P,B as F,aD as V,aE as q,aF as i}from"./main-D6Ea68y6.js";import{t as w}from"./api-D0npd75W.js";import{F as z,a as o,b as t,c,d as l,e as d,f as j}from"./form-W0sNp3sF.js";const H=q({nome_empresa:i().min(2,"Nome muito curto"),email_contato:i().email(),horario_inicio:i(),horario_fim:i(),cor_primaria:i(),cor_secundaria:i(),hms_app_access_key:i().optional(),hms_app_secret:i().optional(),hms_management_token:i().optional(),hms_template_id:i().optional(),hms_api_base_url:i().optional()});function $(){const{toast:m}=B(),k=D(),{data:h,isLoading:E}=S({queryKey:["/api/tenants/me"],queryFn:async()=>(await w.me()).data}),v=C({mutationFn:async s=>(await w.update(s)).data,onSuccess:()=>{k.invalidateQueries({queryKey:["/api/tenants/me"]}),m({title:"Configura√ß√µes salvas",description:"As configura√ß√µes do tenant foram atualizadas com sucesso."})},onError:s=>{m({title:"Erro ao salvar",description:s.response?.data?.message||"N√£o foi poss√≠vel salvar as configura√ß√µes.",variant:"destructive"})}}),a=K({resolver:V(H),defaultValues:{nome_empresa:"",email_contato:"",horario_inicio:"09:00",horario_fim:"18:00",cor_primaria:"#3B82F6",cor_secundaria:"#10B981",hms_app_access_key:"",hms_app_secret:"",hms_management_token:"",hms_template_id:"",hms_api_base_url:"https://api.100ms.live/v2"}}),{data:p}=S({queryKey:["/api/config/hms100ms/credentials"],queryFn:async()=>{try{const s=await fetch("/api/config/hms100ms/sync-from-env",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(s.ok){const x=await s.json();if(console.log("‚úÖ [HMS] Credenciais sincronizadas",{syncedFromEnv:x.syncedFromEnv}),x.credentials)return x}const r=await fetch("/api/config/hms100ms/credentials",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});return r.ok?r.json():null}catch(s){return console.error("‚ùå [HMS] Erro ao carregar credenciais:",s),null}}});T.useEffect(()=>{if(h){const s=h.configuracoes||{},r={nome_empresa:h.nome||"",email_contato:h.email||"",horario_inicio:s.horario_comercial?.inicio||"09:00",horario_fim:s.horario_comercial?.fim||"18:00",cor_primaria:s.cores?.primaria||"#3B82F6",cor_secundaria:s.cores?.secundaria||"#10B981",hms_app_access_key:p?.credentials?.appAccessKey||"",hms_app_secret:p?.credentials?.appSecret||"",hms_management_token:p?.credentials?.managementToken||"",hms_template_id:p?.credentials?.templateId||"",hms_api_base_url:p?.credentials?.apiBaseUrl||"https://api.100ms.live/v2"};console.log("üìã [Configuracoes] Resetando formul√°rio HMS com dados:",{appAccessKey:r.hms_app_access_key?"‚úÖ":"‚ùå",appSecret:r.hms_app_secret?"‚úÖ":"‚ùå",managementToken:r.hms_management_token?"‚úÖ":"‚ùå",templateId:r.hms_template_id?"‚úÖ":"‚ùå",apiBaseUrl:r.hms_api_base_url}),a.reset(r)}},[h,p,a]);const A=C({mutationFn:async s=>{const r=await fetch("/api/config/hms100ms",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(s)});if(!r.ok)throw new Error("Erro ao salvar configura√ß√£o");return r.json()},onSuccess:()=>{k.invalidateQueries({queryKey:["/api/config/hms100ms/credentials"]}),m({title:"100ms configurado",description:"Credenciais salvas com sucesso"})},onError:s=>{m({title:"Erro",description:s.message,variant:"destructive"})}}),b=C({mutationFn:async s=>{const r=await fetch("/api/config/hms100ms/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const x=await r.json();throw new Error(x.error||"Credenciais inv√°lidas")}return r.json()},onSuccess:()=>{m({title:"Sucesso!",description:"Credenciais do 100ms validadas com sucesso"})},onError:s=>{m({title:"Erro na valida√ß√£o",description:s.message,variant:"destructive"})}});function I(s){v.mutate({nome:s.nome_empresa,email:s.email_contato,configuracoes:{horario_comercial:{inicio:s.horario_inicio,fim:s.horario_fim},duracao_padrao:60,cores:{primaria:s.cor_primaria,secundaria:s.cor_secundaria}}}),s.hms_app_access_key&&s.hms_app_secret&&A.mutate({appAccessKey:s.hms_app_access_key,appSecret:s.hms_app_secret,managementToken:s.hms_management_token,templateId:s.hms_template_id,apiBaseUrl:s.hms_api_base_url})}return E?e.jsx("div",{className:"flex items-center justify-center h-[50vh]",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Configura√ß√µes"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie as configura√ß√µes da sua empresa e integra√ß√µes."})]}),e.jsx(M,{}),e.jsx(z,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(I),className:"space-y-8",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(u,{children:[e.jsxs(_,{children:[e.jsx(g,{children:"Dados da Empresa"}),e.jsx(f,{children:"Informa√ß√µes vis√≠veis para seus clientes."})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsx(o,{control:a.control,name:"nome_empresa",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"Nome da Empresa"}),e.jsx(l,{children:e.jsx(n,{...s})}),e.jsx(d,{})]})}),e.jsx(o,{control:a.control,name:"email_contato",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"Email de Contato"}),e.jsx(l,{children:e.jsx(n,{...s})}),e.jsx(d,{})]})})]})]}),e.jsxs(u,{children:[e.jsxs(_,{children:[e.jsx(g,{children:"Hor√°rio Comercial"}),e.jsx(f,{children:"Defina os hor√°rios dispon√≠veis para agendamento."})]}),e.jsx(y,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:a.control,name:"horario_inicio",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"Abertura"}),e.jsx(l,{children:e.jsx(n,{type:"time",...s})}),e.jsx(d,{})]})}),e.jsx(o,{control:a.control,name:"horario_fim",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"Fechamento"}),e.jsx(l,{children:e.jsx(n,{type:"time",...s})}),e.jsx(d,{})]})})]})})]}),e.jsxs(u,{children:[e.jsxs(_,{children:[e.jsx(g,{children:"Personaliza√ß√£o"}),e.jsx(f,{children:"Cores e identidade visual da sua marca."})]}),e.jsx(y,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:a.control,name:"cor_primaria",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"Cor Prim√°ria"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded border",style:{backgroundColor:s.value}}),e.jsx(l,{children:e.jsx(n,{...s})})]}),e.jsx(d,{})]})}),e.jsx(o,{control:a.control,name:"cor_secundaria",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"Cor Secund√°ria"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded border",style:{backgroundColor:s.value}}),e.jsx(l,{children:e.jsx(n,{...s})})]}),e.jsx(d,{})]})})]})})]}),e.jsxs(u,{className:"md:col-span-2",children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx(g,{children:"Integra√ß√£o com Reuni√£o (100ms)"}),e.jsx(f,{children:"Configure as credenciais para ativar videoconfer√™ncia em tempo real"})]})]})}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(o,{control:a.control,name:"hms_app_access_key",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"App Access Key *"}),e.jsx(l,{children:e.jsx(n,{...s,placeholder:"646..."})}),e.jsx(j,{children:"Chave de acesso do 100ms"}),e.jsx(d,{})]})}),e.jsx(o,{control:a.control,name:"hms_app_secret",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"App Secret *"}),e.jsx(l,{children:e.jsx(n,{type:"password",...s})}),e.jsx(j,{children:"Chave secreta do 100ms"}),e.jsx(d,{})]})}),e.jsx(o,{control:a.control,name:"hms_management_token",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"Management Token"}),e.jsx(l,{children:e.jsx(n,{type:"password",...s})}),e.jsx(j,{children:"Token para gerenciar salas (opcional)"}),e.jsx(d,{})]})}),e.jsx(o,{control:a.control,name:"hms_template_id",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"Template ID"}),e.jsx(l,{children:e.jsx(n,{...s,placeholder:"645..."})}),e.jsx(j,{children:"ID do template de sala"}),e.jsx(d,{})]})})]}),e.jsx(o,{control:a.control,name:"hms_api_base_url",render:({field:s})=>e.jsxs(t,{children:[e.jsx(c,{children:"API Base URL"}),e.jsx(l,{children:e.jsx(n,{...s})}),e.jsx(j,{children:"URL base da API do 100ms (padr√£o: https://api.100ms.live/v2)"}),e.jsx(d,{})]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm text-blue-900",children:["‚ÑπÔ∏è ",e.jsx("strong",{children:"Como obter as credenciais:"})]}),e.jsxs("ul",{className:"text-sm text-blue-800 mt-2 space-y-1 ml-4 list-disc",children:[e.jsxs("li",{children:["Visite ",e.jsx("a",{href:"https://dashboard.100ms.live",target:"_blank",rel:"noopener noreferrer",className:"underline font-semibold",children:"dashboard.100ms.live"})]}),e.jsx("li",{children:"V√° para Configura√ß√µes ‚Üí Credenciais"}),e.jsx("li",{children:"Copie App Access Key e App Secret"}),e.jsx("li",{children:"Configure um Template de Sala para obter o Template ID"})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(F,{type:"button",variant:"outline",disabled:b.isPending||!a.getValues("hms_app_access_key")||!a.getValues("hms_app_secret"),onClick:()=>b.mutate({appAccessKey:a.getValues("hms_app_access_key"),appSecret:a.getValues("hms_app_secret")}),"data-testid":"button-test-100ms",children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),"Testando..."]}):"Testar Conex√£o 100ms"}),e.jsx(F,{type:"submit",size:"lg",disabled:v.isPending,"data-testid":"button-save-config",children:v.isPending?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvando..."]}):"Salvar Configura√ß√£o"})]})]})})]})}export{$ as default};
