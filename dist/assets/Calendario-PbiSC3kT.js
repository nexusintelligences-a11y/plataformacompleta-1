import{j as e}from"./ui-vendor-BtEcf0g7.js";import{r as D}from"./react-vendor-DUZ_c4H6.js";import{u as A,a as M,b as g,s as T,e as q,c as E,d as O,f as _,B as x,C as L,g as C,p as F,h as Q,i as R,j as H,k,l as S,L as K,P as I,m as P,n as z,o as B,q as W,r as G,D as $,t as J,v as U,w as V,x as X,y as Y,z as N,I as b,A as Z,E as ee}from"./main-DVW5hlyI.js";import{r as m}from"./api-DDrtQDax.js";function ae(c){const i=A(),{data:d=[],isLoading:o,error:t}=M({queryKey:["/api/reunioes"],queryFn:async()=>(await m.list()).data,staleTime:30*1e3}),{data:l,isLoading:p,error:j}=M({queryKey:["/api/reunioes",c],queryFn:async()=>{throw new Error("ID is required")},enabled:!1}),u=g({mutationFn:async s=>(await m.create(s)).data,onSuccess:()=>{i.invalidateQueries({queryKey:["/api/reunioes"]})}}),h=g({mutationFn:async({id:s,data:n})=>(await m.update(s,n)).data,onSuccess:(s,{id:n})=>{i.invalidateQueries({queryKey:["/api/reunioes"]}),i.invalidateQueries({queryKey:["/api/reunioes",n]})}}),f=g({mutationFn:async s=>(await m.delete(s)).data,onSuccess:()=>{i.invalidateQueries({queryKey:["/api/reunioes"]})}}),v=g({mutationFn:async s=>(await m.getToken100ms(s)).data}),y=g({mutationFn:async s=>(await m.checkAvailability(s)).data}),a=g({mutationFn:async s=>(await m.createInstant(s)).data,onSuccess:()=>{i.invalidateQueries({queryKey:["/api/reunioes"]})}});return{meetings:d,meeting:l,loading:o||p,error:t||j,addMeeting:s=>u.mutateAsync(s),updateMeeting:(s,n)=>h.mutateAsync({id:s,data:n}),deleteMeeting:s=>f.mutateAsync(s),getToken100ms:s=>v.mutateAsync(s),checkAvailability:s=>y.mutateAsync(s),createInstantMeeting:s=>a.mutateAsync(s),isCreating:u.isPending,isCreatingInstant:a.isPending,createError:u.error}}function se({meetings:c,onDateClick:i}){const[d,o]=D.useState(new Date),t=T(d),l=q(t),p=E(t),j=O(l),u=_({start:p,end:j}),h=()=>o(B(d,1)),f=()=>o(z(d)),v=()=>o(new Date),y=a=>c.filter(s=>W(new Date(s.data_inicio),a));return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",onClick:v,children:"Hoje"}),e.jsxs("div",{className:"flex items-center border rounded-md",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:f,children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-40 text-center font-medium",children:C(d,"MMMM yyyy",{locale:F})}),e.jsx(x,{variant:"ghost",size:"icon",onClick:h,children:e.jsx(Q,{className:"h-4 w-4"})})]})]})}),e.jsx(R,{className:"flex-1 flex flex-col border rounded-md overflow-hidden",children:e.jsxs(H,{className:"p-0 flex-1 flex flex-col",children:[e.jsx("div",{className:"grid grid-cols-7 border-b bg-muted/20",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(a=>e.jsx("div",{className:"py-3 text-center text-sm font-semibold text-muted-foreground",children:a},a))}),e.jsx("div",{className:"flex-1 grid grid-cols-7 grid-rows-5",children:u.map((a,s)=>{const n=y(a);return e.jsxs("div",{className:k("min-h-[100px] border-b border-r p-2 transition-colors hover:bg-muted/10 cursor-pointer relative group bg-background",!P(a,t)&&"bg-muted/5 text-muted-foreground",S(a)&&"bg-blue-50/50 dark:bg-blue-900/10",s%7===0&&"border-l"),onClick:()=>i(a),children:[e.jsx("div",{className:k("text-sm font-medium mb-1 h-7 w-7 flex items-center justify-center rounded-full",S(a)&&"bg-primary text-primary-foreground"),children:C(a,"d")}),e.jsx("div",{className:"space-y-1",children:n.map(r=>e.jsx(K,{href:`/reuniao/${r.id}`,children:e.jsx("div",{className:"text-xs p-1.5 rounded bg-blue-100 text-blue-700 dark:bg-blue-900/40 dark:text-blue-200 truncate hover:opacity-80 transition-opacity border-l-2 border-blue-500 shadow-sm",title:r.titulo,onClick:w=>w.stopPropagation(),children:e.jsxs("div",{className:"font-semibold truncate",children:[C(new Date(r.data_inicio),"HH:mm")," ",r.titulo]})})},r.id))}),e.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(x,{size:"icon",variant:"secondary",className:"h-6 w-6 rounded-full shadow-sm",children:e.jsx(I,{className:"h-3 w-3"})})})]},a.toString())})})]})})]})}function oe(){const[c,i]=D.useState(null),[d,o]=D.useState(!1),[t,l]=D.useState({titulo:"",nome:"",email:"",horario:"09:00",descricao:""}),{meetings:p,addMeeting:j,isCreating:u}=ae(),{toast:h}=G(),f=a=>{i(a),o(!0)},v=async()=>{if(!c)return;const[a,s]=t.horario.split(":"),n=new Date(c);n.setHours(parseInt(a),parseInt(s));const r=new Date(n);r.setHours(r.getHours()+1);try{await j({titulo:t.titulo,nome:t.nome,email:t.email,telefone:"",descricao:t.descricao,dataInicio:n.toISOString(),dataFim:r.toISOString()}),o(!1),l({titulo:"",nome:"",email:"",horario:"09:00",descricao:""}),h({title:"Reunião Agendada!",description:"A reunião foi criada com sucesso."})}catch(w){h({title:"Erro ao agendar",description:w.response?.data?.message||"Não foi possível criar a reunião.",variant:"destructive"})}},y=p.map(a=>({id:a.id,titulo:a.titulo,nome:a.nome,email:a.email,telefone:a.telefone||"",data_inicio:a.dataInicio,data_fim:a.dataFim,status:a.status,link_reuniao:a.linkReuniao,room_id_100ms:a.roomId100ms,tenant_id:a.tenantId,usuario_id:a.usuarioId||""}));return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-8rem)]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Calendário"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie seus agendamentos."})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs($,{open:d,onOpenChange:o,children:[e.jsx(J,{asChild:!0,children:e.jsxs(x,{onClick:()=>i(new Date),children:[e.jsx(I,{className:"mr-2 h-4 w-4"})," Nova Reunião"]})}),e.jsxs(U,{className:"sm:max-w-[500px]",children:[e.jsxs(V,{children:[e.jsx(X,{children:"Agendar Nova Reunião"}),e.jsx(Y,{children:"Preencha os detalhes para criar um agendamento e gerar o link da sala."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"date",className:"text-right",children:"Data"}),e.jsx("div",{className:"col-span-3 font-medium",children:c?C(c,"dd 'de' MMMM, yyyy",{locale:F}):"Selecione uma data"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"titulo",className:"text-right",children:"Título"}),e.jsx(b,{id:"titulo",className:"col-span-3",placeholder:"Ex: Reunião de Alinhamento",value:t.titulo,onChange:a=>l({...t,titulo:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"cliente",className:"text-right",children:"Cliente"}),e.jsx(b,{id:"cliente",className:"col-span-3",placeholder:"Nome do cliente",value:t.nome,onChange:a=>l({...t,nome:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"email",className:"text-right",children:"Email"}),e.jsx(b,{id:"email",className:"col-span-3",placeholder:"cliente@email.com",value:t.email,onChange:a=>l({...t,email:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(N,{htmlFor:"horario",className:"text-right",children:"Horário"}),e.jsx(b,{id:"horario",type:"time",className:"col-span-3",value:t.horario,onChange:a=>l({...t,horario:a.target.value})})]})]}),e.jsx(Z,{children:e.jsx(x,{type:"submit",onClick:v,disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"mr-2 h-4 w-4 animate-spin"}),"Agendando..."]}):"Agendar e Enviar Convite"})})]})]})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx(se,{meetings:y,onDateClick:f})})]})}export{oe as default};
